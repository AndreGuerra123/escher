<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>bar graphs</title>
    <script src="js/libs/d3.v3.js" type="text/javascript"></script>
    <script src="js/libs/vkbeautify.js" type="text/javascript"></script>
    <script src="js/vis/export-svg.js" type="text/javascript"></script>
    <script src="js/vis/subplot.js" type="text/javascript"></script>
    <script src="js/vis/bar.js" type="text/javascript"></script>
    <script src="js/vis/category-legend.js" type="text/javascript"></script>
    <meta charset="utf-8" />
  </head>
  <body>
    <div id="container" style="width:600px; height:400px"></div>
    <script type="text/javascript">
      var static_categories = ['ALCD2x', 'GLUDyi', 'GAPD', 'MDH', 'ASADi', 'SACCD1', 'HSDxi', 'PGCD', 'SHK3D', 'XYLR'];
      var subplot = Subplot().setup({ rows: 4, columns: 2, 
                                      selection: d3.select("#container") });
      var legend = CategoryLegend().setup({ sub_selection: subplot.frame_by_row_col(0,1), 
					    categories: static_categories });
      var bar1 = Bar().setup({ sub_selection: subplot.frame_by_row_col(0, 0), 
			       css_path: 'css/bar.css',
			       data_is_object: false,
			       color_scale: legend.get_scale(),
			       title: 'Glucose anaerobic' });
      var bar2 = Bar().setup({ sub_selection: subplot.frame_by_row_col(1, 0), 
			       css_path: 'css/bar.css',
			       data_is_object: false,
			       color_scale: legend.get_scale(),
			       title: 'D-Xylose anaerobic' });
      var bar3 = Bar().setup({ sub_selection: subplot.frame_by_row_col(2, 0), 
			       css_path: 'css/bar.css',
			       data_is_object: false,
			       color_scale: legend.get_scale(),
			       title: 'Glucose aerobic' });
      var bar4 = Bar().setup({ sub_selection: subplot.frame_by_row_col(3, 0), 
			       css_path: 'css/bar.css',
			       data_is_object: false,
			       color_scale: legend.get_scale(),
			       title: 'D-Xylose aerobic' });
      var ex = ExportSvg();
      d3.select('body').append('button').text('download').on('click', function(d) { ex.download('chart', 'svg', true); });
      var process_optyield_data = function(d) {
	  var i = -1;
	  while (++i < d.length) {
	      var t = d[i];
	      t.value = t.diff;
	      t.category = t.swap;
	      // t.name = t.name;
	  }
	  return d;
      };
      d3.json('data/optyield/yeast_glucose_anaerobic.json', function(error, d) {
	  bar1.collect_data(process_optyield_data(d), 0);
      });      
      d3.json('data/optyield/yeast_xylose_anaerobic.json', function(error, d) {
      	  bar2.collect_data(process_optyield_data(d), 0);
      });      
      d3.json('data/optyield/yeast_glucose_aerobic.json', function(error, d) {
      	  bar3.collect_data(process_optyield_data(d), 0);
      });
      d3.json('data/optyield/yeast_xylose_aerobic.json', function(error, d) {
      	  bar4.collect_data(process_optyield_data(d), 0);
      });	      
      </script>
  </body>
</html>
